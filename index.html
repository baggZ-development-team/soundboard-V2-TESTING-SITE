<!DOCTYPE html>
<html lang="en-GB">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FWZLJYXDTE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FWZLJYXDTE');
</script>
    <meta charset="utf-8" />
    <title>Soundboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>
</head>
<body id="vanta-background">
    <h1>baggZ Soundboard</h1>
    <h3 id="loading">If a sound isn't working wait a second.</h3>

    <div id="search-container">
        <input type="text" id="searchBar" placeholder="Search sounds...">
    </div>

    <button id="stopBtn">Stop</button>

    <div id="buttons" display="none"></div>

    <!-- SVG DISTORTION FILTER -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%">
                <feTurbulence
                    type="fractalNoise"
                    baseFrequency="0.01 0.01"
                    numOctaves="2"
                    seed="42"
                    result="noise"
                />
                <feGaussianBlur in="noise" stdDeviation="1.5" result="blurred" />
                <feDisplacementMap
                    in="SourceGraphic"
                    in2="blurred"
                    scale="60"
                    xChannelSelector="R"
                    yChannelSelector="G"
                />
            </filter>
        </defs>
    </svg>

    <script>
        // Vibrant color palette (unique colors only)
        const vibrantColors = [
            0xff006e, // Hot Pink
            0x8338ec, // Purple
            0x3a86ff, // Bright Blue
            0x06ffa5, // Cyan
            0xffbe0b, // Yellow
            0xfb5607, // Orange
        ];

        // Calculate color distance in RGB space
        function colorDistance(color1, color2) {
            const r1 = (color1 >> 16) & 0xFF;
            const g1 = (color1 >> 8) & 0xFF;
            const b1 = color1 & 0xFF;
            
            const r2 = (color2 >> 16) & 0xFF;
            const g2 = (color2 >> 8) & 0xFF;
            const b2 = color2 & 0xFF;
            
            // Euclidean distance in RGB space
            return Math.sqrt(
                Math.pow(r1 - r2, 2) + 
                Math.pow(g1 - g2, 2) + 
                Math.pow(b1 - b2, 2)
            );
        }

        // Select colors that are sufficiently different
        function selectDifferentColors(minDistance = 100) {
            const selected = [];
            const available = [...vibrantColors];
            
            // Select first color randomly
            let firstIndex = Math.floor(Math.random() * available.length);
            selected.push(available[firstIndex]);
            available.splice(firstIndex, 1);
            
            // Select second color that's different from first
            let secondIndex = 0;
            let attempts = 0;
            do {
                secondIndex = Math.floor(Math.random() * available.length);
                attempts++;
                if (attempts > 50) break; // Prevent infinite loop
            } while (colorDistance(selected[0], available[secondIndex]) < minDistance && available.length > 1);
            
            selected.push(available[secondIndex]);
            available.splice(secondIndex, 1);
            
            // Select third color that's different from both
            let thirdIndex = 0;
            attempts = 0;
            do {
                thirdIndex = Math.floor(Math.random() * available.length);
                attempts++;
                if (attempts > 50) break; // Prevent infinite loop
            } while (
                (colorDistance(selected[0], available[thirdIndex]) < minDistance ||
                 colorDistance(selected[1], available[thirdIndex]) < minDistance) && 
                available.length > 0
            );
            
            if (available.length > 0) {
                selected.push(available[thirdIndex]);
            } else {
                // Fallback: pick any remaining color
                selected.push(vibrantColors[Math.floor(Math.random() * vibrantColors.length)]);
            }
            
            return selected;
        }

        // Initialize Vanta Fog with random vibrant colors
        function initVanta() {
            const colors = selectDifferentColors(100);
            const baseColor = colors[0];
            const highlightColor = colors[1];
            const midColor = colors[2];

            VANTA.FOG({
                el: "#vanta-background",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                highlightColor: highlightColor,
                baseColor: baseColor,
                midColor: midColor,
                blurFactor: 0.47,
                speed: 1.5,
                zoom: 0.9
            });
        }

        // Initialize Vanta after page load
        window.addEventListener('load', initVanta);

        // Search functionality
        (async () => {
            const res = await fetch("Audios.json");
            const data = await res.json();

            const stopBtn = document.getElementById("stopBtn");
            const container = document.getElementById("buttons");
            const searchBar = document.getElementById("searchBar");
            const loading = document.getElementById("loading");

            let currentAudio = null;
            let allButtons = [];

            // Create buttons
            data.files.forEach(file => {
                const btn = document.createElement("button");
                const displayName = file.split(".")[0].replace(/[_-]/g, " ");
                btn.textContent = displayName;
                btn.dataset.searchText = displayName.toLowerCase();

                const audio = new Audio(`audio/${file}`);
                
                btn.onclick = () => {
                    if (currentAudio && currentAudio !== audio) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                    }
                    currentAudio = audio;
                    audio.play();
                };

                container.appendChild(btn);
                allButtons.push(btn);
            });

            // Hide loading message after buttons are created
            loading.style.display = "none";

            // Search functionality
            searchBar.addEventListener("input", (e) => {
                const searchTerm = e.target.value.toLowerCase();
                allButtons.forEach(btn => {
                    if (btn.dataset.searchText.includes(searchTerm)) {
                        btn.style.display = "inline-block";
                    } else {
                        btn.style.display = "none";
                    }
                });
            });

            stopBtn.onclick = () => {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
            };
        })();
    </script>
</body>
</html>
